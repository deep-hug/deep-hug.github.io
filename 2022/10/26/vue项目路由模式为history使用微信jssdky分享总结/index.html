

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="前端小菜鸟，因为项目要对接微信的jssdk，每回遇到微信分享都是一个坑，项目使用Vue开发，采用history的路由模式，对接就需要签名认证，但是无奈安卓和IOS各有各的坑，最后终于解决了，现将解决的过程分享一下。">
  <meta name="author" content="deephug">
  <meta name="keywords" content="">
  
  <title>vue项目路由模式为history使用微信jssdky分享总结 - DeepHug&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"deep-hug.github.io","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/wallhaven-e7zogk.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="vue项目路由模式为history使用微信jssdky分享总结">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-10-26 16:06" pubdate>
        2022年10月26日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      110
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">vue项目路由模式为history使用微信jssdky分享总结</h1>
            
            <div class="markdown-body">
              <h2 id="调用微信-JSSDK-来实现分享功能"><a href="#调用微信-JSSDK-来实现分享功能" class="headerlink" title="调用微信 JSSDK 来实现分享功能"></a>调用微信 JSSDK 来实现分享功能</h2><blockquote>
<p>前端小菜鸟，因为项目要对接微信的jssdk，每回遇到微信分享都是一个坑，项目使用Vue开发，采用history的路由模式，对接就需要签名认证，但是无奈安卓和IOS各有各的坑，最后终于解决了，现将解决的过程分享一下。</p>
</blockquote>
<h2 id="闲话"><a href="#闲话" class="headerlink" title="闲话"></a>闲话</h2><p>公司有个需求要做微信分享，而且是全局的分享（每个页面都要有分享功能）功能。为了以后能方便点，就封装了一下。 <strong>不是懒不是懒不是懒！！！重要的事情说三遍！！！</strong></p>
<h2 id="技术要点"><a href="#技术要点" class="headerlink" title="技术要点"></a>技术要点</h2><p>Vue, history路由</p>
<h2 id="常见问题及说明"><a href="#常见问题及说明" class="headerlink" title="常见问题及说明"></a>常见问题及说明</h2><h3 id="debug模式下报false"><a href="#debug模式下报false" class="headerlink" title="debug模式下报false"></a>debug模式下报false</h3><p>这个没得说，就是调用wx.config方法的参数错误造成的，请确认以下事项：</p>
<p>是否成功绑定了域名（域名校验文件要能被访问到）</p>
<ul>
<li>1、使用最新的js-sdk文件，因为微信会改部分api</li>
<li>2、config方法的参数是否传正确了（拼写错误、大小写…）</li>
<li>3、需要使用的方法是否写在了<strong>jsApiList</strong>中</li>
<li>4、获取签名的url需要<strong>decodeURIComponent</strong></li>
<li>5、后台的生成签名的加密方法需要对照官方文档</li>
</ul>
<h3 id="debug返回ok，分享不成功"><a href="#debug返回ok，分享不成功" class="headerlink" title="debug返回ok，分享不成功"></a>debug返回ok，分享不成功</h3><ul>
<li>1、确保代码拼写正确</li>
<li>2、分享链接域名或路径必须与当前页面对应的公众号JS安全域名一致</li>
<li>3、接口调用需要放在wx.ready方法中</li>
</ul>
<h3 id="路由传参的时候参数字符串里面不要带额外的"><a href="#路由传参的时候参数字符串里面不要带额外的" class="headerlink" title="路由传参的时候参数字符串里面不要带额外的 ="></a>路由传参的时候参数字符串里面不要带额外的 =</h3><p>这是什么意思呢？</p>
<p>在我的项目里面会有一些页面传参，有时候会传递 json 字符串，项目规定不可明文传输数据，所以又把 json字符串 ，通过base64.encode了一下，就导致了在url最后面会有连续两个 <strong>==</strong> ，然后这个页面的分享就失效了，直接 <strong>debug的时候就false，报签名不通过</strong> 。解决办法就是再将其 encodeURIComponent 一下，然后进行页面跳转</p>
<h4 id="2022-11-10补充"><a href="#2022-11-10补充" class="headerlink" title="2022-11-10补充"></a>2022-11-10补充</h4><p>特殊字符的URL编码方式</p>
<table>
<thead>
<tr>
<th>特殊符号</th>
<th>编码后的字符</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>%2B</td>
</tr>
<tr>
<td>空格</td>
<td>%20</td>
</tr>
<tr>
<td>/</td>
<td>%2F</td>
</tr>
<tr>
<td>?</td>
<td>%3F</td>
</tr>
<tr>
<td>%</td>
<td>%25</td>
</tr>
<tr>
<td>#</td>
<td>%23</td>
</tr>
<tr>
<td>&amp;</td>
<td>%26</td>
</tr>
<tr>
<td>=</td>
<td>%3D</td>
</tr>
</tbody></table>
<p><strong>如果URL中有这些特殊字符是不允许的，需要将参数 decodeURIComponent 一下</strong></p>
<p><strong>巨坑巨坑巨坑，这个坑绝对是微信的巨坑，这个bug我测试了许久才测试出来</strong></p>
<h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><ul>
<li>安利一个在微信下能检测内核的判断：window.__wxjs_is_wkwebview(是否为webview内核)，如果是的情况下就变成true</li>
<li>因为SPA应用下，会有一定的问题，路由采用的是history模式(不带#号)。因为在页面每次进入到路由之后才去获取签名授权，所以将方法公用写在路由的模块下3</li>
<li>window.entryUrl这个是什么鬼？这个是自己定义的全局属性，就是为了获取IOS第一次进入页面的时候存储起来的，如果IOS的签名的路径不是第一次进入的页面，那么就一定会失败，所以这个路由第一次进入就要储存起来</li>
<li>为什么要写在router.afterEach，因为页面进入了再去做申请和签名，如果在beforeEach，会导致页面申请签名的时候还是上一个页面，但是到了新页面却没有注册签名，或者因为签名的路径不同，导致invalid signature</li>
<li>为什么安卓的时候要增加一个延时器，因为安卓会存在一些情况，就是即便签名成功，但是还是会唤不起功能，这个貌似是一个比较稳妥的解决办法，</li>
</ul>
<h2 id="单页项目（SPA）中的一些要点"><a href="#单页项目（SPA）中的一些要点" class="headerlink" title="单页项目（SPA）中的一些要点"></a>单页项目（SPA）中的一些要点</h2><blockquote>
<p>所有需要使用JS-SDK的页面必须先注入配置信息，否则将无法调用（同一个url仅需调用一次，对于变化url的SPA的web app可在每次url变化时进行调用,目前Android微信客户端不支持pushState的H5新特性，所以使用pushState来实现web app的页面会导致签名失败，此问题会在Android6.2中修复）。</p>
</blockquote>
<p>上面那段话摘自<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html">官方文档</a></p>
<p>开发者需要注意的事项：</p>
<ul>
<li>1、android和ios需要分开处理</li>
<li>2、需要在页面url变化的时候重新调用 <strong>wx.config</strong> 方法，android获取签名的url就传 <strong>window.location.href</strong></li>
<li>3、Vue项目在切换页面时，IOS中浏览器的url并不会改变，依旧是第一次进入页面的地址，所以IOS获取签名的url需要传第一次进入的页面url</li>
</ul>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p><a target="_blank" rel="noopener" href="https://res2.wx.qq.com/open/js/jweixin-1.6.0.js">微信的jssdk</a>，我是把文件copy了一份放在了本地。</p>
<p><strong>jweixin-1.6.0</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>!<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e,n</span>)</span>&#123;<span class="hljs-string">&quot;function&quot;</span>==<span class="hljs-keyword">typeof</span> define&amp;&amp;(define.amd||define.cmd)?define(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span> n(e)&#125;):n(e,!<span class="hljs-number">0</span>)&#125;(<span class="hljs-built_in">this</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o,e</span>)</span>&#123;<span class="hljs-keyword">if</span>(!o.jWeixin)&#123;<span class="hljs-keyword">var</span> n,c=&#123;<span class="hljs-attr">config</span>:<span class="hljs-string">&quot;preVerifyJSAPI&quot;</span>,<span class="hljs-attr">onMenuShareTimeline</span>:<span class="hljs-string">&quot;menu:share:timeline&quot;</span>,<span class="hljs-attr">onMenuShareAppMessage</span>:<span class="hljs-string">&quot;menu:share:appmessage&quot;</span>,<span class="hljs-attr">onMenuShareQQ</span>:<span class="hljs-string">&quot;menu:share:qq&quot;</span>,<span class="hljs-attr">onMenuShareWeibo</span>:<span class="hljs-string">&quot;menu:share:weiboApp&quot;</span>,<span class="hljs-attr">onMenuShareQZone</span>:<span class="hljs-string">&quot;menu:share:QZone&quot;</span>,<span class="hljs-attr">previewImage</span>:<span class="hljs-string">&quot;imagePreview&quot;</span>,<span class="hljs-attr">getLocation</span>:<span class="hljs-string">&quot;geoLocation&quot;</span>,<span class="hljs-attr">openProductSpecificView</span>:<span class="hljs-string">&quot;openProductViewWithPid&quot;</span>,<span class="hljs-attr">addCard</span>:<span class="hljs-string">&quot;batchAddCard&quot;</span>,<span class="hljs-attr">openCard</span>:<span class="hljs-string">&quot;batchViewCard&quot;</span>,<span class="hljs-attr">chooseWXPay</span>:<span class="hljs-string">&quot;getBrandWCPayRequest&quot;</span>,<span class="hljs-attr">openEnterpriseRedPacket</span>:<span class="hljs-string">&quot;getRecevieBizHongBaoRequest&quot;</span>,<span class="hljs-attr">startSearchBeacons</span>:<span class="hljs-string">&quot;startMonitoringBeacons&quot;</span>,<span class="hljs-attr">stopSearchBeacons</span>:<span class="hljs-string">&quot;stopMonitoringBeacons&quot;</span>,<span class="hljs-attr">onSearchBeacons</span>:<span class="hljs-string">&quot;onBeaconsInRange&quot;</span>,<span class="hljs-attr">consumeAndShareCard</span>:<span class="hljs-string">&quot;consumedShareCard&quot;</span>,<span class="hljs-attr">openAddress</span>:<span class="hljs-string">&quot;editAddress&quot;</span>&#125;,a=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">var</span> e=&#123;&#125;;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> c)e[c[n]]=n;<span class="hljs-keyword">return</span> e&#125;(),i=o.document,t=i.title,r=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),d=!(!s.match(<span class="hljs-string">&quot;mac&quot;</span>)&amp;&amp;!s.match(<span class="hljs-string">&quot;win&quot;</span>)),u=-<span class="hljs-number">1</span>!=r.indexOf(<span class="hljs-string">&quot;wxdebugger&quot;</span>),l=-<span class="hljs-number">1</span>!=r.indexOf(<span class="hljs-string">&quot;micromessenger&quot;</span>),p=-<span class="hljs-number">1</span>!=r.indexOf(<span class="hljs-string">&quot;android&quot;</span>),f=-<span class="hljs-number">1</span>!=r.indexOf(<span class="hljs-string">&quot;iphone&quot;</span>)||-<span class="hljs-number">1</span>!=r.indexOf(<span class="hljs-string">&quot;ipad&quot;</span>),m=(n=r.match(<span class="hljs-regexp">/micromessenger\/(\d+\.\d+\.\d+)/</span>)||r.match(<span class="hljs-regexp">/micromessenger\/(\d+\.\d+)/</span>))?n[<span class="hljs-number">1</span>]:<span class="hljs-string">&quot;&quot;</span>,g=&#123;<span class="hljs-attr">initStartTime</span>:L(),<span class="hljs-attr">initEndTime</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">preVerifyStartTime</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">preVerifyEndTime</span>:<span class="hljs-number">0</span>&#125;,h=&#123;<span class="hljs-attr">version</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">appId</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">initTime</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">preVerifyTime</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">networkType</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">isPreVerifyOk</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">systemType</span>:f?<span class="hljs-number">1</span>:p?<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>,<span class="hljs-attr">clientVersion</span>:m,<span class="hljs-attr">url</span>:<span class="hljs-built_in">encodeURIComponent</span>(location.href)&#125;,v=&#123;&#125;,S=&#123;<span class="hljs-attr">_completes</span>:[]&#125;,y=&#123;<span class="hljs-attr">state</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">data</span>:&#123;&#125;&#125;;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;g.initEndTime=L()&#125;);<span class="hljs-keyword">var</span> I=!<span class="hljs-number">1</span>,_=[],w=&#123;<span class="hljs-attr">config</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;B(<span class="hljs-string">&quot;config&quot;</span>,v=e);<span class="hljs-keyword">var</span> t=!<span class="hljs-number">1</span>!==v.check;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span>(t)M(c.config,&#123;<span class="hljs-attr">verifyJsApiList</span>:C(v.jsApiList),<span class="hljs-attr">verifyOpenTagList</span>:C(v.openTagList)&#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;S._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;g.preVerifyEndTime=L(),y.state=<span class="hljs-number">1</span>,y.data=e&#125;,S.success=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;h.isPreVerifyOk=<span class="hljs-number">0</span>&#125;,S.fail=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;S._fail?S._fail(e):y.state=-<span class="hljs-number">1</span>&#125;;<span class="hljs-keyword">var</span> t=S._completes;<span class="hljs-keyword">return</span> t.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;!<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span>(!(d||u||v.debug||m&lt;<span class="hljs-string">&quot;6.0.2&quot;</span>||h.systemType&lt;<span class="hljs-number">0</span>))&#123;<span class="hljs-keyword">var</span> i=<span class="hljs-keyword">new</span> Image;h.appId=v.appId,h.initTime=g.initEndTime-g.initStartTime,h.preVerifyTime=g.preVerifyEndTime-g.preVerifyStartTime,w.getNetworkType(&#123;<span class="hljs-attr">isInnerInvoke</span>:!<span class="hljs-number">0</span>,<span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;h.networkType=e.networkType;<span class="hljs-keyword">var</span> n=<span class="hljs-string">&quot;https://open.weixin.qq.com/sdk/report?v=&quot;</span>+h.version+<span class="hljs-string">&quot;&amp;o=&quot;</span>+h.isPreVerifyOk+<span class="hljs-string">&quot;&amp;s=&quot;</span>+h.systemType+<span class="hljs-string">&quot;&amp;c=&quot;</span>+h.clientVersion+<span class="hljs-string">&quot;&amp;a=&quot;</span>+h.appId+<span class="hljs-string">&quot;&amp;n=&quot;</span>+h.networkType+<span class="hljs-string">&quot;&amp;i=&quot;</span>+h.initTime+<span class="hljs-string">&quot;&amp;p=&quot;</span>+h.preVerifyTime+<span class="hljs-string">&quot;&amp;u=&quot;</span>+h.url;i.src=n&#125;&#125;)&#125;&#125;()&#125;),S.complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n=<span class="hljs-number">0</span>,i=t.length;n&lt;i;++n)t[n]();S._completes=[]&#125;,S&#125;()),g.preVerifyStartTime=L();<span class="hljs-keyword">else</span>&#123;y.state=<span class="hljs-number">1</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> e=S._completes,n=<span class="hljs-number">0</span>,i=e.length;n&lt;i;++n)e[n]();S._completes=[]&#125;&#125;),w.invoke||(w.invoke=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e,n,i</span>)</span>&#123;o.WeixinJSBridge&amp;&amp;WeixinJSBridge.invoke(e,x(n),i)&#125;,w.on=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e,n</span>)</span>&#123;o.WeixinJSBridge&amp;&amp;WeixinJSBridge.on(e,n)&#125;)&#125;,<span class="hljs-attr">ready</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-number">0</span>!=y.state?e():(S._completes.push(e),!l&amp;&amp;v.debug&amp;&amp;e())&#125;,<span class="hljs-attr">error</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;m&lt;<span class="hljs-string">&quot;6.0.2&quot;</span>||(-<span class="hljs-number">1</span>==y.state?e(y.data):S._fail=e)&#125;,<span class="hljs-attr">checkJsApi</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;checkJsApi&quot;</span>,&#123;<span class="hljs-attr">jsApiList</span>:C(e.jsApiList)&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(p)&#123;<span class="hljs-keyword">var</span> n=e.checkResult;n&amp;&amp;(e.checkResult=<span class="hljs-built_in">JSON</span>.parse(n))&#125;e=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">var</span> n=e.checkResult;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> n)&#123;<span class="hljs-keyword">var</span> t=a[i];t&amp;&amp;(n[t]=n[i],<span class="hljs-keyword">delete</span> n[i])&#125;<span class="hljs-keyword">return</span> e&#125;(e)&#125;,e))&#125;,<span class="hljs-attr">onMenuShareTimeline</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(c.onMenuShareTimeline,&#123;<span class="hljs-attr">complete</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;shareTimeline&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title||t,<span class="hljs-attr">desc</span>:e.title||t,<span class="hljs-attr">img_url</span>:e.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:e.link||location.href,<span class="hljs-attr">type</span>:e.type||<span class="hljs-string">&quot;link&quot;</span>,<span class="hljs-attr">data_url</span>:e.dataUrl||<span class="hljs-string">&quot;&quot;</span>&#125;,e)&#125;&#125;,e)&#125;,<span class="hljs-attr">onMenuShareAppMessage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>)</span>&#123;P(c.onMenuShareAppMessage,&#123;<span class="hljs-attr">complete</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-string">&quot;favorite&quot;</span>===e.scene?M(<span class="hljs-string">&quot;sendAppMessage&quot;</span>,&#123;<span class="hljs-attr">title</span>:n.title||t,<span class="hljs-attr">desc</span>:n.desc||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:n.link||location.href,<span class="hljs-attr">img_url</span>:n.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">type</span>:n.type||<span class="hljs-string">&quot;link&quot;</span>,<span class="hljs-attr">data_url</span>:n.dataUrl||<span class="hljs-string">&quot;&quot;</span>&#125;):M(<span class="hljs-string">&quot;sendAppMessage&quot;</span>,&#123;<span class="hljs-attr">title</span>:n.title||t,<span class="hljs-attr">desc</span>:n.desc||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:n.link||location.href,<span class="hljs-attr">img_url</span>:n.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">type</span>:n.type||<span class="hljs-string">&quot;link&quot;</span>,<span class="hljs-attr">data_url</span>:n.dataUrl||<span class="hljs-string">&quot;&quot;</span>&#125;,n)&#125;&#125;,n)&#125;,<span class="hljs-attr">onMenuShareQQ</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(c.onMenuShareQQ,&#123;<span class="hljs-attr">complete</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;shareQQ&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title||t,<span class="hljs-attr">desc</span>:e.desc||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">img_url</span>:e.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:e.link||location.href&#125;,e)&#125;&#125;,e)&#125;,<span class="hljs-attr">onMenuShareWeibo</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(c.onMenuShareWeibo,&#123;<span class="hljs-attr">complete</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;shareWeiboApp&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title||t,<span class="hljs-attr">desc</span>:e.desc||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">img_url</span>:e.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:e.link||location.href&#125;,e)&#125;&#125;,e)&#125;,<span class="hljs-attr">onMenuShareQZone</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(c.onMenuShareQZone,&#123;<span class="hljs-attr">complete</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;shareQZone&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title||t,<span class="hljs-attr">desc</span>:e.desc||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">img_url</span>:e.imgUrl||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">link</span>:e.link||location.href&#125;,e)&#125;&#125;,e)&#125;,<span class="hljs-attr">updateTimelineShareData</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;updateTimelineShareData&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title,<span class="hljs-attr">link</span>:e.link,<span class="hljs-attr">imgUrl</span>:e.imgUrl&#125;,e)&#125;,<span class="hljs-attr">updateAppMessageShareData</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;updateAppMessageShareData&quot;</span>,&#123;<span class="hljs-attr">title</span>:e.title,<span class="hljs-attr">desc</span>:e.desc,<span class="hljs-attr">link</span>:e.link,<span class="hljs-attr">imgUrl</span>:e.imgUrl&#125;,e)&#125;,<span class="hljs-attr">startRecord</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;startRecord&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">stopRecord</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;stopRecord&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">onVoiceRecordEnd</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(<span class="hljs-string">&quot;onVoiceRecordEnd&quot;</span>,e)&#125;,<span class="hljs-attr">playVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;playVoice&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId&#125;,e)&#125;,<span class="hljs-attr">pauseVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;pauseVoice&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId&#125;,e)&#125;,<span class="hljs-attr">stopVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;stopVoice&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId&#125;,e)&#125;,<span class="hljs-attr">onVoicePlayEnd</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(<span class="hljs-string">&quot;onVoicePlayEnd&quot;</span>,e)&#125;,<span class="hljs-attr">uploadVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;uploadVoice&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId,<span class="hljs-attr">isShowProgressTips</span>:<span class="hljs-number">0</span>==e.isShowProgressTips?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>&#125;,e)&#125;,<span class="hljs-attr">downloadVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;downloadVoice&quot;</span>,&#123;<span class="hljs-attr">serverId</span>:e.serverId,<span class="hljs-attr">isShowProgressTips</span>:<span class="hljs-number">0</span>==e.isShowProgressTips?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>&#125;,e)&#125;,<span class="hljs-attr">translateVoice</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;translateVoice&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId,<span class="hljs-attr">isShowProgressTips</span>:<span class="hljs-number">0</span>==e.isShowProgressTips?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>&#125;,e)&#125;,<span class="hljs-attr">chooseImage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;chooseImage&quot;</span>,&#123;<span class="hljs-attr">scene</span>:<span class="hljs-string">&quot;1|2&quot;</span>,<span class="hljs-attr">count</span>:e.count||<span class="hljs-number">9</span>,<span class="hljs-attr">sizeType</span>:e.sizeType||[<span class="hljs-string">&quot;original&quot;</span>,<span class="hljs-string">&quot;compressed&quot;</span>],<span class="hljs-attr">sourceType</span>:e.sourceType||[<span class="hljs-string">&quot;album&quot;</span>,<span class="hljs-string">&quot;camera&quot;</span>]&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(p)&#123;<span class="hljs-keyword">var</span> n=e.localIds;<span class="hljs-keyword">try</span>&#123;n&amp;&amp;(e.localIds=<span class="hljs-built_in">JSON</span>.parse(n))&#125;<span class="hljs-keyword">catch</span>(e)&#123;&#125;&#125;&#125;,e))&#125;,<span class="hljs-attr">getLocation</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;&#125;,<span class="hljs-attr">previewImage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.previewImage,&#123;<span class="hljs-attr">current</span>:e.current,<span class="hljs-attr">urls</span>:e.urls&#125;,e)&#125;,<span class="hljs-attr">uploadImage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;uploadImage&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId,<span class="hljs-attr">isShowProgressTips</span>:<span class="hljs-number">0</span>==e.isShowProgressTips?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>&#125;,e)&#125;,<span class="hljs-attr">downloadImage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;downloadImage&quot;</span>,&#123;<span class="hljs-attr">serverId</span>:e.serverId,<span class="hljs-attr">isShowProgressTips</span>:<span class="hljs-number">0</span>==e.isShowProgressTips?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>&#125;,e)&#125;,<span class="hljs-attr">getLocalImgData</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;!<span class="hljs-number">1</span>===I?(I=!<span class="hljs-number">0</span>,M(<span class="hljs-string">&quot;getLocalImgData&quot;</span>,&#123;<span class="hljs-attr">localId</span>:e.localId&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(I=!<span class="hljs-number">1</span>,<span class="hljs-number">0</span>&lt;_.length)&#123;<span class="hljs-keyword">var</span> n=_.shift();wx.getLocalImgData(n)&#125;&#125;,e))):_.push(e)&#125;,<span class="hljs-attr">getNetworkType</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;getNetworkType&quot;</span>,&#123;&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;e=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">var</span> n=e.errMsg;e.errMsg=<span class="hljs-string">&quot;getNetworkType:ok&quot;</span>;<span class="hljs-keyword">var</span> i=e.subtype;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">delete</span> e.subtype,i)e.networkType=i;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">var</span> t=n.indexOf(<span class="hljs-string">&quot;:&quot;</span>),o=n.substring(t+<span class="hljs-number">1</span>);<span class="hljs-keyword">switch</span>(o)&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;wifi&quot;</span>:<span class="hljs-keyword">case</span><span class="hljs-string">&quot;edge&quot;</span>:<span class="hljs-keyword">case</span><span class="hljs-string">&quot;wwan&quot;</span>:e.networkType=o;<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:e.errMsg=<span class="hljs-string">&quot;getNetworkType:fail&quot;</span>&#125;&#125;<span class="hljs-keyword">return</span> e&#125;(e)&#125;,e))&#125;,<span class="hljs-attr">openLocation</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;openLocation&quot;</span>,&#123;<span class="hljs-attr">latitude</span>:e.latitude,<span class="hljs-attr">longitude</span>:e.longitude,<span class="hljs-attr">name</span>:e.name||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">address</span>:e.address||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">scale</span>:e.scale||<span class="hljs-number">28</span>,<span class="hljs-attr">infoUrl</span>:e.infoUrl||<span class="hljs-string">&quot;&quot;</span>&#125;,e)&#125;,<span class="hljs-attr">getLocation</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.getLocation,&#123;<span class="hljs-attr">type</span>:(e=e||&#123;&#125;).type||<span class="hljs-string">&quot;wgs84&quot;</span>&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">delete</span> e.type&#125;,e))&#125;,<span class="hljs-attr">hideOptionMenu</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;hideOptionMenu&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">showOptionMenu</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;showOptionMenu&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">closeWindow</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;closeWindow&quot;</span>,&#123;&#125;,e=e||&#123;&#125;)&#125;,<span class="hljs-attr">hideMenuItems</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;hideMenuItems&quot;</span>,&#123;<span class="hljs-attr">menuList</span>:e.menuList&#125;,e)&#125;,<span class="hljs-attr">showMenuItems</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;showMenuItems&quot;</span>,&#123;<span class="hljs-attr">menuList</span>:e.menuList&#125;,e)&#125;,<span class="hljs-attr">hideAllNonBaseMenuItem</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;hideAllNonBaseMenuItem&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">showAllNonBaseMenuItem</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;showAllNonBaseMenuItem&quot;</span>,&#123;&#125;,e)&#125;,<span class="hljs-attr">scanQRCode</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;scanQRCode&quot;</span>,&#123;<span class="hljs-attr">needResult</span>:(e=e||&#123;&#125;).needResult||<span class="hljs-number">0</span>,<span class="hljs-attr">scanType</span>:e.scanType||[<span class="hljs-string">&quot;qrCode&quot;</span>,<span class="hljs-string">&quot;barCode&quot;</span>]&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(f)&#123;<span class="hljs-keyword">var</span> n=e.resultStr;<span class="hljs-keyword">if</span>(n)&#123;<span class="hljs-keyword">var</span> i=<span class="hljs-built_in">JSON</span>.parse(n);e.resultStr=i&amp;&amp;i.scan_code&amp;&amp;i.scan_code.scan_result&#125;&#125;&#125;,e))&#125;,<span class="hljs-attr">openAddress</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.openAddress,&#123;&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;e=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">return</span> e.postalCode=e.addressPostalCode,<span class="hljs-keyword">delete</span> e.addressPostalCode,e.provinceName=e.proviceFirstStageName,<span class="hljs-keyword">delete</span> e.proviceFirstStageName,e.cityName=e.addressCitySecondStageName,<span class="hljs-keyword">delete</span> e.addressCitySecondStageName,e.countryName=e.addressCountiesThirdStageName,<span class="hljs-keyword">delete</span> e.addressCountiesThirdStageName,e.detailInfo=e.addressDetailInfo,<span class="hljs-keyword">delete</span> e.addressDetailInfo,e&#125;(e)&#125;,e))&#125;,<span class="hljs-attr">openProductSpecificView</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.openProductSpecificView,&#123;<span class="hljs-attr">pid</span>:e.productId,<span class="hljs-attr">view_type</span>:e.viewType||<span class="hljs-number">0</span>,<span class="hljs-attr">ext_info</span>:e.extInfo&#125;,e)&#125;,<span class="hljs-attr">addCard</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n=e.cardList,i=[],t=<span class="hljs-number">0</span>,o=n.length;t&lt;o;++t)&#123;<span class="hljs-keyword">var</span> r=n[t],a=&#123;<span class="hljs-attr">card_id</span>:r.cardId,<span class="hljs-attr">card_ext</span>:r.cardExt&#125;;i.push(a)&#125;M(c.addCard,&#123;<span class="hljs-attr">card_list</span>:i&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">var</span> n=e.card_list;<span class="hljs-keyword">if</span>(n)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>,t=(n=<span class="hljs-built_in">JSON</span>.parse(n)).length;i&lt;t;++i)&#123;<span class="hljs-keyword">var</span> o=n[i];o.cardId=o.card_id,o.cardExt=o.card_ext,o.isSuccess=!!o.is_succ,<span class="hljs-keyword">delete</span> o.card_id,<span class="hljs-keyword">delete</span> o.card_ext,<span class="hljs-keyword">delete</span> o.is_succ&#125;e.cardList=n,<span class="hljs-keyword">delete</span> e.card_list&#125;&#125;,e))&#125;,<span class="hljs-attr">chooseCard</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;chooseCard&quot;</span>,&#123;<span class="hljs-attr">app_id</span>:v.appId,<span class="hljs-attr">location_id</span>:e.shopId||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">sign_type</span>:e.signType||<span class="hljs-string">&quot;SHA1&quot;</span>,<span class="hljs-attr">card_id</span>:e.cardId||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">card_type</span>:e.cardType||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">card_sign</span>:e.cardSign,<span class="hljs-attr">time_stamp</span>:e.timestamp+<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">nonce_str</span>:e.nonceStr&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;e.cardList=e.choose_card_info,<span class="hljs-keyword">delete</span> e.choose_card_info&#125;,e))&#125;,<span class="hljs-attr">openCard</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n=e.cardList,i=[],t=<span class="hljs-number">0</span>,o=n.length;t&lt;o;++t)&#123;<span class="hljs-keyword">var</span> r=n[t],a=&#123;<span class="hljs-attr">card_id</span>:r.cardId,<span class="hljs-attr">code</span>:r.code&#125;;i.push(a)&#125;M(c.openCard,&#123;<span class="hljs-attr">card_list</span>:i&#125;,e)&#125;,<span class="hljs-attr">consumeAndShareCard</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.consumeAndShareCard,&#123;<span class="hljs-attr">consumedCardId</span>:e.cardId,<span class="hljs-attr">consumedCode</span>:e.code&#125;,e)&#125;,<span class="hljs-attr">chooseWXPay</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.chooseWXPay,V(e),e)&#125;,<span class="hljs-attr">openEnterpriseRedPacket</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.openEnterpriseRedPacket,V(e),e)&#125;,<span class="hljs-attr">startSearchBeacons</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.startSearchBeacons,&#123;<span class="hljs-attr">ticket</span>:e.ticket&#125;,e)&#125;,<span class="hljs-attr">stopSearchBeacons</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(c.stopSearchBeacons,&#123;&#125;,e)&#125;,<span class="hljs-attr">onSearchBeacons</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;P(c.onSearchBeacons,e)&#125;,<span class="hljs-attr">openEnterpriseChat</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;openEnterpriseChat&quot;</span>,&#123;<span class="hljs-attr">useridlist</span>:e.userIds,<span class="hljs-attr">chatname</span>:e.groupName&#125;,e)&#125;,<span class="hljs-attr">launchMiniProgram</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;launchMiniProgram&quot;</span>,&#123;<span class="hljs-attr">targetAppId</span>:e.targetAppId,<span class="hljs-attr">path</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;string&quot;</span>==<span class="hljs-keyword">typeof</span> e&amp;&amp;<span class="hljs-number">0</span>&lt;e.length)&#123;<span class="hljs-keyword">var</span> n=e.split(<span class="hljs-string">&quot;?&quot;</span>)[<span class="hljs-number">0</span>],i=e.split(<span class="hljs-string">&quot;?&quot;</span>)[<span class="hljs-number">1</span>];<span class="hljs-keyword">return</span> n+=<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-keyword">void</span> <span class="hljs-number">0</span>!==i?n+<span class="hljs-string">&quot;?&quot;</span>+i:n&#125;&#125;(e.path),<span class="hljs-attr">envVersion</span>:e.envVersion&#125;,e)&#125;,<span class="hljs-attr">openBusinessView</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;M(<span class="hljs-string">&quot;openBusinessView&quot;</span>,&#123;<span class="hljs-attr">businessType</span>:e.businessType,<span class="hljs-attr">queryString</span>:e.queryString||<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">envVersion</span>:e.envVersion&#125;,(e._complete=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>)</span>&#123;<span class="hljs-keyword">if</span>(p)&#123;<span class="hljs-keyword">var</span> e=n.extraData;<span class="hljs-keyword">if</span>(e)<span class="hljs-keyword">try</span>&#123;n.extraData=<span class="hljs-built_in">JSON</span>.parse(e)&#125;<span class="hljs-keyword">catch</span>(e)&#123;n.extraData=&#123;&#125;&#125;&#125;&#125;,e))&#125;,<span class="hljs-attr">miniProgram</span>:&#123;<span class="hljs-attr">navigateBack</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;e=e||&#123;&#125;,O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;navigateBack&quot;</span>,<span class="hljs-attr">arg</span>:&#123;<span class="hljs-attr">delta</span>:e.delta||<span class="hljs-number">1</span>&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">navigateTo</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;navigateTo&quot;</span>,<span class="hljs-attr">arg</span>:&#123;<span class="hljs-attr">url</span>:e.url&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">redirectTo</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;redirectTo&quot;</span>,<span class="hljs-attr">arg</span>:&#123;<span class="hljs-attr">url</span>:e.url&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">switchTab</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;switchTab&quot;</span>,<span class="hljs-attr">arg</span>:&#123;<span class="hljs-attr">url</span>:e.url&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">reLaunch</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;reLaunch&quot;</span>,<span class="hljs-attr">arg</span>:&#123;<span class="hljs-attr">url</span>:e.url&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">postMessage</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;M(<span class="hljs-string">&quot;invokeMiniProgramAPI&quot;</span>,&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;postMessage&quot;</span>,<span class="hljs-attr">arg</span>:e.data||&#123;&#125;&#125;,e)&#125;)&#125;,<span class="hljs-attr">getEnv</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;O(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;e(&#123;<span class="hljs-attr">miniprogram</span>:<span class="hljs-string">&quot;miniprogram&quot;</span>===o.__wxjs_environment&#125;)&#125;)&#125;&#125;&#125;,T=<span class="hljs-number">1</span>,k=&#123;&#125;;<span class="hljs-keyword">return</span> i.addEventListener(<span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(!p)&#123;<span class="hljs-keyword">var</span> n=e.target,i=n.tagName,t=n.src;<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;IMG&quot;</span>==i||<span class="hljs-string">&quot;VIDEO&quot;</span>==i||<span class="hljs-string">&quot;AUDIO&quot;</span>==i||<span class="hljs-string">&quot;SOURCE&quot;</span>==i)<span class="hljs-keyword">if</span>(-<span class="hljs-number">1</span>!=t.indexOf(<span class="hljs-string">&quot;wxlocalresource://&quot;</span>))&#123;e.preventDefault(),e.stopPropagation();<span class="hljs-keyword">var</span> o=n[<span class="hljs-string">&quot;wx-id&quot;</span>];<span class="hljs-keyword">if</span>(o||(o=T++,n[<span class="hljs-string">&quot;wx-id&quot;</span>]=o),k[o])<span class="hljs-keyword">return</span>;k[o]=!<span class="hljs-number">0</span>,wx.ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;wx.getLocalImgData(&#123;<span class="hljs-attr">localId</span>:t,<span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;n.src=e.localData&#125;&#125;)&#125;)&#125;&#125;&#125;,!<span class="hljs-number">0</span>),i.addEventListener(<span class="hljs-string">&quot;load&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(!p)&#123;<span class="hljs-keyword">var</span> n=e.target,i=n.tagName;n.src;<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;IMG&quot;</span>==i||<span class="hljs-string">&quot;VIDEO&quot;</span>==i||<span class="hljs-string">&quot;AUDIO&quot;</span>==i||<span class="hljs-string">&quot;SOURCE&quot;</span>==i)&#123;<span class="hljs-keyword">var</span> t=n[<span class="hljs-string">&quot;wx-id&quot;</span>];t&amp;&amp;(k[t]=!<span class="hljs-number">1</span>)&#125;&#125;&#125;,!<span class="hljs-number">0</span>),e&amp;&amp;(o.wx=o.jWeixin=w),w&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">M</span>(<span class="hljs-params">n,e,i</span>)</span>&#123;o.WeixinJSBridge?WeixinJSBridge.invoke(n,x(e),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;A(n,e,i)&#125;):B(n,i)&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">P</span>(<span class="hljs-params">n,i,t</span>)</span>&#123;o.WeixinJSBridge?WeixinJSBridge.on(n,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;t&amp;&amp;t.trigger&amp;&amp;t.trigger(e),A(n,e,i)&#125;):B(n,t||i)&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">x</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">return</span>(e=e||&#123;&#125;).appId=v.appId,e.verifyAppId=v.appId,e.verifySignType=<span class="hljs-string">&quot;sha1&quot;</span>,e.verifyTimestamp=v.timestamp+<span class="hljs-string">&quot;&quot;</span>,e.verifyNonceStr=v.nonceStr,e.verifySignature=v.signature,e&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">V</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">return</span>&#123;<span class="hljs-attr">timeStamp</span>:e.timestamp+<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">nonceStr</span>:e.nonceStr,<span class="hljs-attr">package</span>:e.package,<span class="hljs-attr">paySign</span>:e.paySign,<span class="hljs-attr">signType</span>:e.signType||<span class="hljs-string">&quot;SHA1&quot;</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params">e,n,i</span>)</span>&#123;<span class="hljs-string">&quot;openEnterpriseChat&quot;</span>!=e&amp;&amp;<span class="hljs-string">&quot;openBusinessView&quot;</span>!==e||(n.errCode=n.err_code),<span class="hljs-keyword">delete</span> n.err_code,<span class="hljs-keyword">delete</span> n.err_desc,<span class="hljs-keyword">delete</span> n.err_detail;<span class="hljs-keyword">var</span> t=n.errMsg;t||(t=n.err_msg,<span class="hljs-keyword">delete</span> n.err_msg,t=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e,n</span>)</span>&#123;<span class="hljs-keyword">var</span> i=e,t=a[i];t&amp;&amp;(i=t);<span class="hljs-keyword">var</span> o=<span class="hljs-string">&quot;ok&quot;</span>;<span class="hljs-keyword">if</span>(n)&#123;<span class="hljs-keyword">var</span> r=n.indexOf(<span class="hljs-string">&quot;:&quot;</span>);<span class="hljs-string">&quot;confirm&quot;</span>==(o=n.substring(r+<span class="hljs-number">1</span>))&amp;&amp;(o=<span class="hljs-string">&quot;ok&quot;</span>),<span class="hljs-string">&quot;failed&quot;</span>==o&amp;&amp;(o=<span class="hljs-string">&quot;fail&quot;</span>),-<span class="hljs-number">1</span>!=o.indexOf(<span class="hljs-string">&quot;failed_&quot;</span>)&amp;&amp;(o=o.substring(<span class="hljs-number">7</span>)),-<span class="hljs-number">1</span>!=o.indexOf(<span class="hljs-string">&quot;fail_&quot;</span>)&amp;&amp;(o=o.substring(<span class="hljs-number">5</span>)),<span class="hljs-string">&quot;access denied&quot;</span>!=(o=(o=o.replace(<span class="hljs-regexp">/_/g</span>,<span class="hljs-string">&quot; &quot;</span>)).toLowerCase())&amp;&amp;<span class="hljs-string">&quot;no permission to execute&quot;</span>!=o||(o=<span class="hljs-string">&quot;permission denied&quot;</span>),<span class="hljs-string">&quot;config&quot;</span>==i&amp;&amp;<span class="hljs-string">&quot;function not exist&quot;</span>==o&amp;&amp;(o=<span class="hljs-string">&quot;ok&quot;</span>),<span class="hljs-string">&quot;&quot;</span>==o&amp;&amp;(o=<span class="hljs-string">&quot;fail&quot;</span>)&#125;<span class="hljs-keyword">return</span> n=i+<span class="hljs-string">&quot;:&quot;</span>+o&#125;(e,t),n.errMsg=t),(i=i||&#123;&#125;)._complete&amp;&amp;(i._complete(n),<span class="hljs-keyword">delete</span> i._complete),t=n.errMsg||<span class="hljs-string">&quot;&quot;</span>,v.debug&amp;&amp;!i.isInnerInvoke&amp;&amp;alert(<span class="hljs-built_in">JSON</span>.stringify(n));<span class="hljs-keyword">var</span> o=t.indexOf(<span class="hljs-string">&quot;:&quot;</span>);<span class="hljs-keyword">switch</span>(t.substring(o+<span class="hljs-number">1</span>))&#123;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;ok&quot;</span>:i.success&amp;&amp;i.success(n);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">&quot;cancel&quot;</span>:i.cancel&amp;&amp;i.cancel(n);<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:i.fail&amp;&amp;i.fail(n)&#125;i.complete&amp;&amp;i.complete(n)&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">C</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">if</span>(e)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n=<span class="hljs-number">0</span>,i=e.length;n&lt;i;++n)&#123;<span class="hljs-keyword">var</span> t=e[n],o=c[t];o&amp;&amp;(e[n]=o)&#125;<span class="hljs-keyword">return</span> e&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">B</span>(<span class="hljs-params">e,n</span>)</span>&#123;<span class="hljs-keyword">if</span>(!(!v.debug||n&amp;&amp;n.isInnerInvoke))&#123;<span class="hljs-keyword">var</span> i=a[e];i&amp;&amp;(e=i),n&amp;&amp;n._complete&amp;&amp;<span class="hljs-keyword">delete</span> n._complete,<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;&quot;&#x27;</span>+e+<span class="hljs-string">&#x27;&quot;,&#x27;</span>,n||<span class="hljs-string">&quot;&quot;</span>)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">L</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime()&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">O</span>(<span class="hljs-params">e</span>)</span>&#123;l&amp;&amp;(o.WeixinJSBridge?e():i.addEventListener&amp;&amp;i.addEventListener(<span class="hljs-string">&quot;WeixinJSBridgeReady&quot;</span>,e,!<span class="hljs-number">1</span>))&#125;&#125;);<br><br></code></pre></td></tr></table></figure>


<p><strong>jweixin.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@Author</span>: deephug</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@Description</span>: 基于微信sdk的封装</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@Date</span>: 2022-10-26 16:27:00</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../static/js/jweixin-1.6.0&#x27;</span>; <span class="hljs-comment">// 引入jssdk文件</span><br>  <span class="hljs-keyword">import</span> &#123; getSdkSignature &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@requests/common&#x27;</span>; <span class="hljs-comment">// 封装请求微信签名的方法</span><br>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wx</span> </span>&#123;<br>      <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> &#123;<br>          <span class="hljs-built_in">this</span>.signMap = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>(); <span class="hljs-comment">// 存储地址url认证信息sign</span><br>          <span class="hljs-comment">// 分享默认参数</span><br>          <span class="hljs-built_in">this</span>.defaultShareConfig = &#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;健康徐汇-互联网诊疗平台&#x27;</span>,<br>              <span class="hljs-attr">desc</span>: <span class="hljs-string">&#x27;健康徐汇打造一站式线上服务平台，为居民提供预约挂号、家庭医生、互联网医院、健康管理、数字健康档案、康复护理、妇幼保健等服务，为居民健康护航！&#x27;</span>,<br>              <span class="hljs-attr">link</span>: location.href,<br>              <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">&#x27;https://wx.wondersph.com/%E5%81%A5%E5%BA%B7%E5%BE%90%E6%B1%87/%E5%81%A5%E5%BA%B7%E5%BE%90%E6%B1%87logo.png&#x27;</span>,<br>              <span class="hljs-attr">jsApiList</span>: [<span class="hljs-string">&#x27;updateAppMessageShareData&#x27;</span>, <span class="hljs-string">&#x27;updateTimelineShareData&#x27;</span>, <span class="hljs-string">&#x27;scanQRCode&#x27;</span>], <span class="hljs-comment">// 分享给朋友分享到QQ，分享到朋友圈，扫一扫</span><br>              <span class="hljs-attr">openTagList</span>: [<span class="hljs-string">&#x27;wx-open-launch-weapp&#x27;</span>], <span class="hljs-comment">// 微信开放标签 必填，需要使用的JS接口列表</span><br>              <span class="hljs-attr">globalShareLink</span>: GLOBAL_DATA.globalShareLink, <span class="hljs-comment">// 全局分享跳转的URL http://10.1.93.110:82/xuhuiH5/openWeiXin https://jkxh.xuhuiheart.com/xuhuiH5/openWeiXin</span><br>          &#125;;<br>          <span class="hljs-comment">// 分享参数</span><br>          <span class="hljs-built_in">this</span>.wxShareConfig = &#123;&#125;;<br>      &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        deephugShare injectAndShare getShareAuth 这三个方法里面都有 return  new Promise，目的是为了在确保 wx.config 通过之后，调用一些 jssdk 其他的api</span><br><span class="hljs-comment">    */</span><br><br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">       * </span><br><span class="hljs-comment">       * <span class="hljs-doctag">@param <span class="hljs-type">&#123;Object&#125;</span> </span>config 分页配置信息，包括title，desc，等等；</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-function"><span class="hljs-title">deephugShare</span>(<span class="hljs-params"> config = &#123;&#125; </span>)</span> &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; &#123;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.title = config.title || <span class="hljs-built_in">this</span>.defaultShareConfig.title;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.desc = config.desc || <span class="hljs-built_in">this</span>.defaultShareConfig.desc;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.link = config.link || <span class="hljs-built_in">this</span>.defaultShareConfig.link;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.imgUrl = config.imgUrl || <span class="hljs-built_in">this</span>.defaultShareConfig.imgUrl;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.jsApiList = config.jsApiList || <span class="hljs-built_in">this</span>.defaultShareConfig.jsApiList;<br>              <span class="hljs-built_in">this</span>.wxShareConfig.openTagList = config.openTagList || <span class="hljs-built_in">this</span>.defaultShareConfig.openTagList;<br><br>              <span class="hljs-keyword">const</span> signMsg = <span class="hljs-built_in">this</span>.signMap.has(<span class="hljs-built_in">this</span>.wxShareConfig.link);<br>              <span class="hljs-keyword">if</span>(signMsg) &#123;<br>                  <span class="hljs-comment">// 注入签名信息， 并调用分享</span><br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;调用分享&#x27;</span>);<br>                  <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.injectAndShare(signMsg);<br>                  resolve();<br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                  <span class="hljs-comment">// 当前分享链接不存在签名 = 更新签名信息</span><br>                  <span class="hljs-comment">// 获取签名信息</span><br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;调用获取签名接口&#x27;</span>);<br>                  <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.getShareAuth(<span class="hljs-built_in">this</span>.wxShareConfig.link);<br>                  resolve();<br>              &#125;<br>          &#125;);<br>      &#125;<br><br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">       * </span><br><span class="hljs-comment">       * <span class="hljs-doctag">@param <span class="hljs-type">&#123;Object&#125;</span> </span>signMsg 接口签名信息</span><br><span class="hljs-comment">       * <span class="hljs-doctag">@desc </span>jssdk签名权限注入，并添加分享事件监听器</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-function"><span class="hljs-title">injectAndShare</span>(<span class="hljs-params">signMsg</span>)</span> &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>              <span class="hljs-built_in">this</span>.wx.config(&#123;<br>                  <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span><br>                  <span class="hljs-attr">appId</span>: signMsg.appId, <span class="hljs-comment">// 必填，公众号的唯一标识</span><br>                  <span class="hljs-attr">timestamp</span>: signMsg.timestamp, <span class="hljs-comment">// 必填，生成签名的时间戳</span><br>                  <span class="hljs-attr">nonceStr</span>: signMsg.nonceStr, <span class="hljs-comment">// 必填，生成签名的随机串</span><br>                  <span class="hljs-attr">signature</span>: signMsg.signature, <span class="hljs-comment">// 必填，签名</span><br>                  <span class="hljs-attr">jsApiList</span>: [<span class="hljs-string">&#x27;updateAppMessageShareData&#x27;</span>, <span class="hljs-string">&#x27;updateTimelineShareData&#x27;</span>, <span class="hljs-string">&#x27;scanQRCode&#x27;</span>],<br>                  <span class="hljs-attr">openTagList</span>: [<span class="hljs-string">&#x27;wx-open-launch-weapp&#x27;</span>]<br>              &#125;);<br><br>              <span class="hljs-built_in">this</span>.wx.ready(<span class="hljs-function">() =&gt;</span> &#123;<br>                  resolve();<br>                  <span class="hljs-keyword">const</span> &#123; title, desc, imgUrl, &#125; = <span class="hljs-built_in">this</span>.wxShareConfig;<br>                  <span class="hljs-keyword">const</span> &#123; globalShareLink &#125; = <span class="hljs-built_in">this</span>.defaultShareConfig;<br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;wx.ready&#x27;</span>, <span class="hljs-string">&#x27;######&#x27;</span>);<br>                  <span class="hljs-built_in">this</span>.wx.updateAppMessageShareData(&#123;<br>                      title,desc,<span class="hljs-attr">link</span>: globalShareLink,imgUrl,<br>                      <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享成功！&#x27;</span>);<br>                      &#125;,<br>                      <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享取消！&#x27;</span>);<br>                      &#125;,<br>                      <span class="hljs-attr">fail</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享失败！&#x27;</span>);<br>                      &#125;<br>                  &#125;);<br>                  <span class="hljs-built_in">this</span>.wx.updateTimelineShareData(&#123;<br>                      title,desc,<span class="hljs-attr">link</span>: globalShareLink,imgUrl,<br>                      <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享成功 -- 朋友圈！&#x27;</span>);<br>                      &#125;,<br>                      <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享取消 -- 朋友圈！&#x27;</span>);<br>                      &#125;,<br>                      <span class="hljs-attr">fail</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;分享失败 -- 朋友圈！&#x27;</span>);<br>                      &#125;<br>                  &#125;);<br>              &#125;);<br>              <span class="hljs-built_in">this</span>.wx.error(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;wx error:&#x27;</span>, res);<br>                  reject(error);<br>              &#125;);<br>          &#125;);<br>      &#125;<br><br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">       * </span><br><span class="hljs-comment">       * <span class="hljs-doctag">@param <span class="hljs-type">&#123;url&#125;</span> </span>shareUrl </span><br><span class="hljs-comment">       * <span class="hljs-doctag">@description </span>从服务器获取分享页面签名信息</span><br><span class="hljs-comment">       */</span><br>      <span class="hljs-function"><span class="hljs-title">getShareAuth</span>(<span class="hljs-params">shareUrl</span>)</span> &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; &#123;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;待获取权限的地址&#x27;</span>, shareUrl);<br>                  <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> getSdkSignature(&#123;<br>                      <span class="hljs-attr">url</span>: <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-built_in">window</span>[<span class="hljs-string">&#x27;entryUrl&#x27;</span>] || shareUrl) <span class="hljs-comment">// window[&#x27;entryUrl&#x27;] 是给ios专门设置的属性</span><br>                  &#125;);<br>                  <span class="hljs-built_in">this</span>.signMap.set(shareUrl, res); <span class="hljs-comment">// 存储信息</span><br>                  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.signMap, <span class="hljs-string">&#x27;5555&#x27;</span>);<br>                  <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.injectAndShare(res); <span class="hljs-comment">// 注入签名信息</span><br>                  resolve();<br>              &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                  <span class="hljs-built_in">console</span>.log(error, <span class="hljs-string">&#x27;error&#x27;</span>);<br>                  <span class="hljs-built_in">this</span>.$dialog.alert(<span class="hljs-string">&#x27;获取微信配置失败&#x27;</span>);<br>              &#125;<br>          &#125;);<br>      &#125;<br>  &#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Wx;<br><br><br></code></pre></td></tr></table></figure>

<p><strong>main.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">// 将 jweixin 挂载到 vue 的原型上面，方便各页面调用</span><br><span class="hljs-keyword">import</span> Wx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../common/utils/jweixin&#x27;</span>;<br>Vue.prototype.$jweixin = <span class="hljs-keyword">new</span> Wx();<br><br></code></pre></td></tr></table></figure>

<p><strong>router/index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>index.afterEach(<span class="hljs-function">(<span class="hljs-params">to</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 由于所有的接口都需要登录后传递token，否则会报错，所以我加了一个白名单，白名单里面的路由不会走默认分享，需要在每个页面login完成后再调用一下分享</span><br>    <span class="hljs-comment">// 白名单屏蔽的是  1、进入项目的第一个页面； 2、页面不仅用到了分享功能，还需要用到别的 jssdk 的api，比如说 扫一扫 (scanQRCode) </span><br>    <span class="hljs-comment">// 由于存在动态路由，屏蔽路由页面不让其分享也是专门写的以下的方法</span><br>    <span class="hljs-keyword">let</span> noShareWhite = [<span class="hljs-string">&#x27;/home&#x27;</span>, <span class="hljs-string">&#x27;/openWeiXin&#x27;</span>, <span class="hljs-string">&#x27;/hosQuestionnaire/:orderId&#x27;</span>, <span class="hljs-string">&#x27;/homeBlank&#x27;</span>, <span class="hljs-string">&#x27;/agreementNursing&#x27;</span>, <span class="hljs-string">&#x27;/applyResult&#x27;</span>, <span class="hljs-string">&#x27;/nursingHome&#x27;</span>, <span class="hljs-string">&#x27;/MyAppointment&#x27;</span>, <span class="hljs-string">&#x27;/nucleicAcidNav&#x27;</span>, <span class="hljs-string">&#x27;/wenjuan/index&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (!to.matched.some(<span class="hljs-function"><span class="hljs-params">ele</span> =&gt;</span> noShareWhite.includes(ele.path))) &#123;<br>        <span class="hljs-keyword">const</span> CURRENT_URL_HISTORY = location.href; <span class="hljs-comment">//注意我的项目使用的history；</span><br>        <span class="hljs-comment">// const CURRENT_URL_HASH = location.href.split(&#x27;#&#x27;)[0]; // hash模式使用这个</span><br>        <span class="hljs-keyword">const</span> SHARE_CONFIG = &#123;<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-attr">desc</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-attr">link</span>: CURRENT_URL_HISTORY, <span class="hljs-comment">// 要分享的页面地址不允许存在#参数</span><br>            <span class="hljs-attr">imgUrl</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// 分享出去链接图片</span><br>        &#125;;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.__wxjs_is_wkwebview) &#123;<br>            <span class="hljs-comment">// 判断是否在 IOS 环境下，如果是则给 window 全局对象添加一个属性，用来存贮 ios 第一次进入页面的 URL，因为 ios 的 spa 应用，如果IOS的签名的路径不是第一次进入的页面，那么就一定会失败，所以这个路由第一次进入就要储存起来。</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>[<span class="hljs-string">&#x27;entryUrl&#x27;</span>] == <span class="hljs-string">&#x27;&#x27;</span> || <span class="hljs-built_in">window</span>[<span class="hljs-string">&#x27;entryUrl&#x27;</span>] == <span class="hljs-literal">undefined</span>) &#123;<br>                <span class="hljs-comment">// 这里和jweixin.js中getShareAuth方法获取页面url中是同一个</span><br>                <span class="hljs-built_in">window</span>[<span class="hljs-string">&#x27;entryUrl&#x27;</span>] = CURRENT_URL_HISTORY;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.$jweixin.deephugShare(SHARE_CONFIG); <span class="hljs-comment">// 调用分享</span><br>    &#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<p><strong>home.vue</strong></p>
<p>home路由在分享白名单里面，不会走默认的路由，需要在页面里面调用一下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">// 接口如果不传递 token ，则会直接报错，如果当前路由有可能是进入项目的第一个页面，则需要将其路由配置到 router/index.js 的 afterEach 的 noShareWhite 里面，然后再 login 完之后调用分享</span><br><span class="hljs-keyword">const</span> personInfo = storage.getUserInfo();<br><span class="hljs-keyword">if</span> (!personInfo) &#123;<br>    <span class="hljs-built_in">this</span>.login().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-built_in">this</span>.$jweixin.deephugShare(&#123;<span class="hljs-attr">link</span>: location.href&#125;);	<span class="hljs-comment">// 调用分享</span><br>        <span class="hljs-built_in">this</span>.orderId = <span class="hljs-built_in">this</span>.$route.params.orderId;<br>    &#125;);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">this</span>.$jweixin.deephugShare(&#123;<span class="hljs-attr">link</span>: location.href&#125;);	<span class="hljs-comment">// 调用分享</span><br>    <span class="hljs-built_in">this</span>.orderId = <span class="hljs-built_in">this</span>.$route.params.orderId;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><strong>scan.vue</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">// 页面不仅用到了分享功能，还需要用到别的 jssdk 的api，比如说 扫一扫 (scanQRCode)。</span><br><span class="hljs-built_in">this</span>.$jweixin.deephugShare(&#123;<span class="hljs-attr">link</span>: location.href&#125;).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>    <span class="hljs-built_in">this</span>.wx.scanQRCode(&#123;<br>        <span class="hljs-attr">needResult</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果，</span><br>        <span class="hljs-attr">scanType</span>: [<span class="hljs-string">&#x27;qrCode&#x27;</span>, <span class="hljs-string">&#x27;barCode&#x27;</span>], <span class="hljs-comment">// 可以指定扫二维码还是一维码，默认二者都有</span><br>        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>            <span class="hljs-comment">// let qrTxt = res.resultStr;</span><br>            <span class="hljs-comment">// 扫一扫成功</span><br>        &#125;,<br>        <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>            <span class="hljs-comment">// 扫一扫失败</span><br>        &#125;,<br>        <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-comment">// 关闭扫一扫</span><br>        &#125;<br>    &#125;);<br>&#125;);	<span class="hljs-comment">// 调用分享</span><br><br></code></pre></td></tr></table></figure>


<p><strong>OpenWeiXin.vue</strong></p>
<p>微信分享的url不能是全地址(open.weixin.qq.com)，进到页面之后拿不到code和openid，无法调用登录，所以要有一个承载的空白页面用来拼接全地址，然后再跳转过去。<br>OpenWeiXin.vue 就是我的空白页面。里面对 ios 和 Android 也都进行了不同的兼容处理。<br>1、跳转全地址后再返回到 OpenWeiXin 路由时，ios 走不进去 created ，进不去 vue 的生命周期，写了一个监听进入前台后台的方法，用来关闭从home页面返回到 OpenWeiXin 时，关闭浏览器窗口。<br>2、Android 可以走到 vue 的生命周期里面，在跳转全地址之前存储 session ，在 created 判断 session 里面是否有值，如果有则关闭浏览器窗口（加一个 setTimeout ，不然不会生效）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>&lt;template&gt;<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;template-area&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>&lt;/template&gt;<br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="javascript"><span class="xml"><span class="hljs-keyword">import</span> storage <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utils/storage&#x27;</span>; <span class="hljs-comment">// sessionStorage</span></span></span><br><span class="javascript"><span class="xml"><span class="hljs-keyword">import</span> &#123; isIos &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../common/utils/tools&#x27;</span>; <span class="hljs-comment">// 判断当前是否是IOS环境</span></span></span><br><span class="javascript"><span class="xml"><span class="hljs-keyword">import</span> &#123; goOpenWeixin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../requests/common&#x27;</span>; <span class="hljs-comment">// 组装全连接（open.weixin.qq.com）</span></span></span><br><span class="javascript"><span class="xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">return</span> &#123;&#125;;</span></span><br><span class="javascript"><span class="xml">    &#125;,</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">mounted</span>(<span class="hljs-params"></span>)</span>&#123;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-built_in">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="javascript"><span class="xml"></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// 当前页面只是一个中转页面，分享的 url 是没有 open.weixin 的，此页面是为了拼接全地址（open.weixin）后再跳转到对应的页面。</span></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// 2022-10-12 需求，在健康徐汇所有的页面分享后的地址要全部跳转到 home 页面，所以当前版本比较简单，只做了 te 和 pe 两种地址的跳转。</span></span></span><br><span class="javascript"><span class="xml"></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// 处理 ios 兼容问题，无论使用 href、assign、 replace ， Android的表现为：从home页面物理返回之后还是回会到当前页面。 Android解决办法：跳转的时候设置session，created的时候如果session的值为true，则使用微信的api关闭当前浏览器窗口。</span></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// ios的表现为：home页面物理返回后不会触发生命周期。ios解决办法：需要 监听页面切换到 ‘前台’ 的事件，然后使用微信的api关闭当前浏览器窗口。</span></span></span><br><span class="javascript"><span class="xml"></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// ios解决办法</span></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">if</span> (isIos()) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">&#x27;visibilitychange&#x27;</span>, <span class="hljs-built_in">this</span>.visibilitychange, <span class="hljs-literal">false</span>);</span></span><br><span class="javascript"><span class="xml">            &#125;</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// Android解决办法</span></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">if</span> (storage.getOnceLoadOpenWeiXin()) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-built_in">window</span>.WeixinJSBridge &amp;&amp; WeixinJSBridge.call(<span class="hljs-string">&#x27;closeWindow&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">                &#125;, <span class="hljs-number">200</span>);</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">return</span>;</span></span><br><span class="javascript"><span class="xml">            &#125;;</span></span><br><span class="javascript"><span class="xml"></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">let</span> targetPath = <span class="hljs-built_in">this</span>.$tools.getParameterByName(<span class="hljs-string">&#x27;targetPath&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-built_in">console</span>.log(targetPath, <span class="hljs-string">&#x27;targetPath--targetPath&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// 互联网医院分享来源，需要先判断是否实名，如果实名跳转到徐汇互联网医院</span></span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">if</span> (targetPath == <span class="hljs-string">&#x27;hospitalH5&#x27;</span>) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-comment">// Android跳转前设置session</span></span></span><br><span class="javascript"><span class="xml">                storage.setOnceLoadOpenWeiXin(<span class="hljs-string">&#x27;true&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">switch</span> (PUBLIC_CODE) &#123;</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-built_in">window</span>.location.replace(goOpenWeixin(<span class="hljs-string">&#x27;/xuhuiH5/homeBlank?sourceFrom=2&#x27;</span>));</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-built_in">window</span>.location.replace(goOpenWeixin(<span class="hljs-string">&#x27;/xuhuiH5/homeBlank?sourceFrom=2&#x27;</span>));</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-built_in">window</span>.location.replace(goOpenWeixin(<span class="hljs-string">&#x27;/xuhuiH5/homeBlank?sourceFrom=2&#x27;</span>));</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">default</span>:</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-built_in">this</span>.$router.replace(&#123;</span></span><br><span class="javascript"><span class="xml">                            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/homeBlank&#x27;</span>,</span></span><br><span class="javascript"><span class="xml">                            <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">sourceFrom</span>: <span class="hljs-number">2</span> &#125;</span></span><br><span class="javascript"><span class="xml">                        &#125;);</span></span><br><span class="javascript"><span class="xml">                        <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                &#125;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">return</span>;</span></span><br><span class="javascript"><span class="xml">            &#125;</span></span><br><span class="javascript"><span class="xml">            </span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">let</span> peURL = <span class="hljs-string">&#x27;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx8ea774edbad0cf5b&amp;redirect_uri=https%3A%2F%2Fjkxh.xuhuiheart.com%2FxuhuiH5%2Fhome&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=310104000000#wechat_redirect&#x27;</span>;</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">let</span> teURL = <span class="hljs-string">&#x27;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx7954261f30ad20b0&amp;redirect_uri=http%3A%2F%2F10.1.93.110%3A82%2FxuhuiH5%2Fhome&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=310104000000#wechat_redirect&#x27;</span>;</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-comment">// Android跳转前设置session</span></span></span><br><span class="javascript"><span class="xml">            storage.setOnceLoadOpenWeiXin(<span class="hljs-string">&#x27;true&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">switch</span> (PUBLIC_CODE) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-built_in">window</span>.location.replace(teURL);</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-built_in">window</span>.location.replace(peURL);</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-built_in">window</span>.location.replace(peURL);</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-keyword">default</span>:</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;组装open.weixin全地址&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">                    <span class="hljs-keyword">break</span>;</span></span><br><span class="javascript"><span class="xml">            &#125;</span></span><br><span class="javascript"><span class="xml">        &#125;);</span></span><br><span class="javascript"><span class="xml"></span></span><br><span class="javascript"><span class="xml">    &#125;,</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">destroyed</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">&#x27;visibilitychange&#x27;</span>, <span class="hljs-built_in">this</span>.visibilitychange, <span class="hljs-literal">false</span>);</span></span><br><span class="javascript"><span class="xml">    &#125;,</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-attr">methods</span>: &#123;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-function"><span class="hljs-title">visibilitychange</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.visibilityState == <span class="hljs-string">&#x27;hidden&#x27;</span>) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-comment">// alert(&#x27;切换到后台&#x27;);</span></span></span><br><span class="javascript"><span class="xml">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.visibilityState == <span class="hljs-string">&#x27;visible&#x27;</span>) &#123;</span></span><br><span class="javascript"><span class="xml">                <span class="hljs-comment">// alert(&#x27;切换到前台&#x27;);</span></span></span><br><span class="javascript"><span class="xml">                <span class="hljs-built_in">window</span>.WeixinJSBridge &amp;&amp; WeixinJSBridge.call(<span class="hljs-string">&#x27;closeWindow&#x27;</span>);</span></span><br><span class="javascript"><span class="xml">            &#125;</span></span><br><span class="javascript"><span class="xml">        &#125;</span></span><br><span class="javascript"><span class="xml">    &#125;,</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-attr">components</span>: &#123;&#125;</span></span><br><span class="javascript"><span class="xml">&#125;;</span></span><br><span class="javascript"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css"></span></span><br><span class="css"><span class="xml"><span class="hljs-selector-class">.template-area</span>&#123;</span></span><br><span class="css"><span class="xml">    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;</span></span><br><span class="css"><span class="xml">    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</span></span><br><span class="css"><span class="xml">&#125;</span></span><br><span class="css"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Fluid/">Fluid</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/21/write-to-yourself/">
                        <span class="hidden-mobile">write-to-yourself</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
